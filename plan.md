# Project ART (자동화된 거래) - 개발 진행 상황

## 프로젝트 개요
Project ART는 암호화폐 자동 거래 시스템을 개발하는 프로젝트입니다. 주요 기능으로는:
- 실시간 암호화폐 가격 데이터 수집
- 기술적 분석 및 삼중장벽 전략 기반 신호 생성
- 리스크 관리 및 포트폴리오 최적화
- 실시간 거래 실행 및 모니터링
- 성과 분석 및 백테스팅

## PRD (제품 요구사항)
### 1. 시스템 요구사항
- Python 3.8 이상
- 주요 의존성 패키지:
  - python-binance: 암호화폐 데이터 수집
  - influxdb-client: 시계열 데이터 저장
  - python-telegram-bot: 실시간 알림
  - backtrader: 백테스팅
  - numpy, pandas: 데이터 처리

### 2. 핵심 기능 요구사항
1. **데이터 수집 및 처리**
   - Binance API를 통한 실시간/과거 데이터 수집
   - InfluxDB를 통한 데이터 저장 및 관리
   - 데이터 정합성 검증 및 에러 처리

2. **거래 전략**
   - 삼중장벽 전략 구현
   - 기술적 지표 계산 (MA, RSI, MACD 등)
   - 트렌드 감지 및 신호 생성

3. **리스크 관리**
   - 포지션 크기 최적화
   - 손절/익절 레벨 설정
   - 포트폴리오 리밸런싱

4. **알림 시스템**
   - 텔레그램을 통한 실시간 알림
   - 거래 신호 알림
   - 에러 발생 알림
   - 성과 보고서 알림

5. **백테스팅**
   - 과거 데이터 기반 백테스팅
   - 성과 지표 계산
   - 전략 최적화

### 3. 보안 요구사항
- API 키 및 비밀번호는 환경 변수나 별도의 credentials 파일로 관리
- 모든 API 호출에 에러 처리 및 재시도 로직 구현
- 로깅 및 모니터링 시스템 구현

## 프로젝트 진행 체크리스트
### 1. 환경 설정
- [x] Python 환경 설정
- [x] 필요한 패키지 설치
- [x] 환경 변수 설정
- [x] credentials 파일 설정

### 2. 데이터 파이프라인
- [x] Binance 데이터 수집기 구현
- [x] InfluxDB 데이터 저장 구현
- [x] 데이터 검증 및 에러 처리
- [x] InfluxDB 설치 및 실행 확인

### 3. 알림 시스템
- [x] 텔레그램 알림 구현
- [x] 비동기 API 적용
- [x] 에러 처리 및 재시도 로직

### 4. 통합 테스트 (현재 진행 중)
- [ ] 데이터 수집 → 저장 → 알림 흐름 테스트
- [ ] 에러 시나리오 테스트
- [ ] 성능 테스트
- [ ] 스케줄링 테스트

## 작업 목록
- [x] 프로젝트 폴더 구조 및 __init__.py 패키지화
- [x] requirements.txt, .gitignore, README.md, config/credentials_example.py 생성
- [x] config/credentials.py 파일에 실제 API 키/토큰 입력 (USER 직접 수행)
- [x] features/build_features.py: 기술적 지표 및 삼중장벽 레이블링 함수 구현
- [x] risk_management/manager.py: RiskManager 클래스 구현
- [x] backtester/run_backtest.py: backtrader 기반 백테스팅 템플릿 구현
- [x] data_pipeline/collector.py: BinanceDataCollector (과거/실시간 수집) 구현
- [x] notifications/telegram_bot.py: TelegramNotifier 구현
- [x] data_pipeline/collector.py의 fetch_historical_data로 바이낸스 과거 데이터 수집 테스트
- [x] 수집 데이터 InfluxDB 저장 및 알림 연동 테스트
- [x] InfluxDB 브라우저(UI) 접속 문제 해결
- [ ] 전체 데이터 파이프라인/알림/백테스팅 통합 테스트

## 현재 목표
- **백테스팅 시스템 구축 시작**: 안정화된 데이터 파이프라인을 기반으로, 백테스팅에 필요한 데이터를 InfluxDB에서 불러오는 기능을 구현합니다.

# Project ART: AI 기반 암호화폐 자동매매 시스템 PRD (v1.1)

- **문서 버전:** 1.1 (아키텍처 및 피처 명세 보강)
- **작성일:** 2025년 6월 19일
- **프로젝트 책임자:** 강현모
- **작성자:** Gemini

---

### 1. 문서 개요 (Overview)

본 문서는 AI 기반 암호화폐 자동매매 시스템, 'Project ART(Algorithmic Risk-managed Trading)'의 구축을 위한 제품 요구사항을 정의합니다. 이 시스템의 최종 비전은 클라우드 서버에서 24시간 무중단 운영되며, 머신러닝 예측 모델과 강화학습 에이전트를 통해 시장 상황에 동적으로 대응하고, 레버리지를 활용하여 수익을 극대화하는 것입니다. 이 모든 과정은 다층적 리스크 관리 시스템의 엄격한 통제 하에 이루어집니다.

---

### 2. 프로젝트 목표 및 비전 (Goal & Vision)

- **비전:** 인간의 감정적 편향과 물리적 한계를 극복하고, 데이터에 기반한 일관된 원칙으로 24시간 암호화폐 시장에 대응하는 완전 자동화된 '퀀트 펀드' 시스템을 구축한다.
- **핵심 문제:** 암호화폐 시장의 높은 변동성과 24시간 운영 특성은 개인 트레이더에게 극심한 피로와 비이성적 판단을 유발합니다. 이를 극복하기 위해 통계적 우위에 기반한 체계적이고 자동화된 접근법이 필요합니다.
- **전략 목표:**
    1.  **Phase 1 (기반 구축):** 6개월 내, 백테스트상에서 샤프 지수 1.0 이상, 최대 낙폭(MDD) 20% 미만을 기록하는 예측 모델(v1)과 핵심 리스크 관리 프레임워크를 완성하고, '퀀터멘털' 방식(모델 신호 + 수동 주문)으로 실효성을 검증한다.
    2.  **Phase 2 (자동화 전환):** Phase 1 성공 후 4개월 내, 예측 모델을 고도화(v2)하고 규칙 기반 실행 엔진을 통합하여 소액 자본으로 자동매매(Paper/Live-Minor)를 시작한다.
    3.  **Phase 3 (동적 최적화):** Phase 2 성공 후, DRL 에이전트를 도입하여 동적 레버리지 및 포지션 관리를 구현하고, 점진적으로 운영 자본을 확대한다.

---

### 3. 시스템 아키텍처 (System Architecture)

본 시스템은 실시간 데이터 처리에 최적화된 **이벤트 기반 아키텍처(Event-Driven Architecture)**를 채택합니다. 이는 각 모듈이 독립적으로 작동하며 이벤트 큐(Event Queue)를 통해 통신하는 방식으로, 시스템의 확장성과 안정성을 높입니다.

#### 3.1. 핵심 모듈 (Core Modules)

1.  **데이터 피드 핸들러 (Data Feed Handler):**
    - **역할:** 거래소 및 대체 데이터 제공업체에 연결하여 모든 수신 데이터를 수집, 정제, 정규화합니다.
    - **산출물:** `MarketEvent` (새로운 시장 데이터 발생 이벤트).

2.  **신호 및 의사결정 엔진 (Signal & Decision Engine):**
    - **역할:** 예측 모델(Phase 1,2)과 RL 에이전트(Phase 3)를 포함하며, `MarketEvent`를 입력받아 거래 행동을 제안합니다.
    - **산출물:** `SignalEvent` (1차적 매수/매도 신호), `OrderEvent` (구체적 주문 제안).

3.  **리스크 관리 모듈 (Risk Management Module):**
    - **역할:** 시스템의 중앙 통제 장치. `OrderEvent`를 받아 포트폴리오 수준의 규칙에 따라 주문을 최종 심사합니다.
    - **산출물:** 승인된 `ValidatedOrderEvent`.

4.  **실행 핸들러 (Execution Handler):**
    - **역할:** `ValidatedOrderEvent`를 받아 실제 거래소 API에 주문을 제출, 모니터링, 취소합니다.
    - **산출물:** `FillEvent` (주문 체결 완료 이벤트).

5.  **포트폴리오 관리자 (Portfolio Manager):**
    - **역할:** `FillEvent`를 받아 현재 포지션, 자산, 손익, 성과 지표를 실시간으로 추적하고 기록합니다. 이 정보는 다시 '신호 및 의사결정 엔진'의 상태(State) 입력값으로 활용됩니다.

#### 3.2. 데이터 흐름 (Data Flow)

새로운 시장 데이터 발생 시 이벤트 흐름은 다음과 같습니다:
1.  **`MarketEvent` 생성:** `데이터 피드 핸들러`가 새로운 캔들 데이터를 수신하고 `MarketEvent`를 생성하여 이벤트 큐에 넣습니다.
2.  **신호 생성:** `신호 및 의사결정 엔진`이 `MarketEvent`를 받아 예측 모델을 실행하고, 유의미한 예측 시 `SignalEvent`를 생성합니다.
3.  **주문 제안:** 엔진의 정책 부분이 `SignalEvent`와 현재 포트폴리오 상태를 종합하여 구체적인 `OrderEvent`를 생성합니다.
4.  **리스크 검증:** `리스크 관리 모듈`이 `OrderEvent`를 받아 포트폴리오의 최대 노출량이나 MDD 한도를 초과하지 않는지 검증합니다.
5.  **주문 실행:** 검증을 통과하면 `실행 핸들러`가 해당 주문을 거래소에 전송합니다.
6.  **상태 업데이트:** 주문이 체결되면 `실행 핸들러`는 `FillEvent`를 생성하고, `포트폴리오 관리자`는 이를 바탕으로 현재 계좌 상태를 업데이트합니다.

---

### 4. 주요 기능 및 요구사항 (Features & Requirements)

개발은 안정성을 확보하며 점진적으로 진행합니다. 각 단계는 이전 단계의 산출물을 기반으로 합니다.

#### 4.1. 피처의 양방향성 및 활용

명시된 피처들은 '숏 전용'이 아닌, 시장의 현재 상태를 설명하는 **'방향 중립적인 서술자(Direction-Neutral Descriptor)'**입니다. 머신러닝 모델은 이 피처들과 실제 가격 움직임(삼중 장벽 레이블: +1, -1, 0)의 관계를 학습하여 롱과 숏 양방향의 기회를 모두 포착합니다. 예를 들어, `rsi_14d` 피처 값이 70 이상이면 과매수로, 30 이하면 과매도로 해석되어 각각 숏과 롱의 근거로 학습됩니다. 모델은 이 피처들의 복합적인 패턴을 통해 현재 시장이 특정 방향에 유리한지 판단합니다.

#### 4.2. Phase 1: 기반 구축 및 퀀터멘털 모델 (MVP)

- **Feature 4.2.1: 데이터 파이프라인 (Data Pipeline)**
    - **요구사항:** 바이낸스(Binance) 거래소의 실시간 및 과거 데이터를 안정적으로 수집하고 처리합니다.
    - **세부 명세:** 실시간(Websocket), 과거(API), 대체(On-chain, Funding) 데이터를 수집하여 시계열 DB(InfluxDB)에 저장합니다.

- **Feature 4.2.2: 예측 모델 (Predictive Model - v1: XGBoost)**
    - **요구사항:** 다중 피처를 입력받아 특정 조건 하의 거래 성공 여부를 예측하는 분류 모델을 구축합니다.
    - **세부 명세:**
        - **모델:** XGBoost 또는 LightGBM.
        - **피처:** 기술적 지표, 온체인, 대체 데이터를 포함한 통합 피처 세트.
        - **레이블링:** '삼중 장벽 방법(Triple Barrier Method)' 사용. (익절, 손절, 시간제한).
        - **검증:** 워크 포워드 분석(Walk-Forward Analysis)을 통해 모델 성능을 엄격히 검증합니다.

- **Feature 4.2.3: 핵심 리스크 관리 모듈 (Risk Management Module - Core)**
    - **요구사항:** 어떤 경우에도 시스템이 치명적인 손실을 입지 않도록 보호하는 다층적 방어 체계를 구축합니다.
    - **세부 명세 (하드코딩된 규칙):**
        - **2계층 (포트폴리오):** 거래당 최대 리스크(예: 1%), 최대 낙폭(MDD) 한도(예: 20%).
        - **3계층 (시스템):** 연결성 검사, API 오류율 한도, 극심한 변동성 감지 서킷 브레이커.

- **Feature 4.2.4: 백테스팅 엔진 (Backtesting Engine)**
    - **요구사항:** 과거 데이터를 사용하여 전략의 성과를 현실적으로 시뮬레이션합니다.
    - **세부 명세:** 이벤트 기반 아키텍처(`Backtrader` 활용), 현실적 거래 비용(수수료, 동적 슬리피지) 모델링.

- **Feature 4.2.5: 알림 및 모니터링 (Alert & Monitoring)**
    - **요구사항:** 예측 모델이 생성한 거래 신호와 시스템 상태를 사용자에게 실시간으로 전달합니다.
    - **세부 명세:** 모델 신호, 리스크 관리 작동, 시스템 오류 발생 시 텔레그램 봇으로 즉시 알림.

#### 4.3. Phase 2: 자동화 전환

- **Feature 4.3.1: 규칙 기반 실행 엔진 (Rules-based Execution Engine)**
    - **요구사항:** Phase 1에서 검증된 예측 모델의 신호를 받아 자동으로 주문을 실행합니다.

- **Feature 4.3.2: 예측 모델 고도화 (Advanced Predictive Model - v2)**
    - **요구사항:** 시간적 패턴 학습에 강점이 있는 시퀀스 모델을 도입하여 예측 성능을 개선합니다.
    - **세부 명세:** BiLSTM-트랜스포머 하이브리드 모델 구현.

#### 4.4. Phase 3: 동적 최적화 (The Full Vision)

- **Feature 4.4.1: 강화학습(DRL) 의사결정 에이전트**
    - **요구사항:** 시장 상황에 맞춰 최적의 행동(포지션 방향, 레버리지, 손절/익절 배수)을 동적으로 결정하는 에이전트를 개발합니다.
    - **세부 명세:** PPO 알고리즘 기반. 상태/행동/보상 공간은 `코인 봇 개발 심층 조사` 문서의 테이블을 따릅니다.

---

### 5. Windsurf (AI 편집기)를 위한 지침

> **General Context for Windsurf:**
> 이 프로젝트의 핵심 철학은 **'안전 우선, 점진적 고도화'**입니다. Phase 1은 시스템의 생존을 위한 기반(데이터, 리스크 관리, 검증)을 다지는 단계입니다. 각 단계의 코드를 생성할 때, 모듈성과 재사용성을 최우선으로 고려해주십시오. 모든 코드는 Python 3.10+ 환경을 기준으로 하며, 주요 라이브러리는 `pandas`, `numpy`, `scikit-learn`, `xgboost`, `backtrader`, `python-binance`, `tensorflow/pytorch` 입니다.

> **Actionable Commands for Windsurf:**
>
> 1.  **Initialize Project Structure:** `/` 디렉토리 아래에 `data_pipeline/`, `features/`, `models/`, `backtester/`, `risk_management/`, `execution/`, `config/` 폴더를 생성하는 스크립트를 작성해주십시오.
> 2.  **Generate Feature Engineering Script (features/build_features.py):** `pandas` DataFrame을 입력받아 **Feature 4.2.2**에 필요한 피처들을 계산하는 함수들을 생성해주십시오. '삼중 장벽 방법'을 구현하는 `get_triple_barrier_labels` 함수를 포함해야 합니다.
> 3.  **Generate Risk Manager Class (risk_management/manager.py):** `RiskManager` 클래스를 생성하고, **Feature 4.2.3**에 명시된 규칙들을 검사하는 메서드를 구현해주십시오.
> 4.  **Generate Backtesting Template (backtester/run_backtest.py):** `backtrader`를 사용하여 Phase 1의 예측 모델(.pkl)을 로드하고, 모델의 예측값에 따라 거래하는 전략 예시를 포함한 템플릿 코드를 생성해주십시오.

---

### 6. 성공 지표 (Success Metrics)

| 지표 범주 | 지표명 | 목표 범위 | 근거/출처 |
| :--- | :--- | :--- | :--- |
| **백테스팅** | 이익 팩터 (Profit Factor) | > 1.5 | |
| | 샤프 지수 (Sharpe Ratio) | > 1.0 | |
| | 최대 낙폭 (Max Drawdown) | < 20% | |
| **실전 운영** | 백테스트 대비 성과 일치도 | 수익률 곡선 상관계수 > 0.8 | |
| | 시스템 다운타임 | < 0.1% | N/A (일반적 SRE 목표) |

---

### 7. 리스크 및 완화 방안

| 리스크 유형 | 설명 | 완화 방안 |
| :--- | :--- | :--- |
| **기술적 리스크** | 모델 과적합 (Overfitting) | 워크 포워드 분석을 통한 엄격한 검증, OOS(Out-of-Sample) 데이터 성능 중시. |
| **시장 리스크** | 블랙 스완 이벤트, 급격한 시장 체제 변화 (Regime Shift) | 3계층 서킷 브레이커 작동. 모델이 훈련되지 않은 극심한 변동성 감지 시 모든 거래 중단. |
| **운영 리스크** | API 오류, 데이터 비용 증가 | 다중 데이터 소스 확보, 예비 API 키 준비, 프로젝트 예산에 데이터 비용 명시적 할당. |

---

# Project ART - 개발 체크리스트
AI 편집기 Windsurf가 개발 단계를 추적하고 각 과업의 완료 여부를 검증하기 위한 체크리스트입니다.
| 단계 | PRD | 과업 (Task) | 상태 | 완료 검증 기준 (Verification Criteria) |
| :--- | :--- | :--- | :--- | :--- |
| Phase 1 | 4.2.1 | 데이터베이스 설정 (InfluxDB) | ☐ 미시작 | 데이터베이스가 성공적으로 설치되고, 원격 접속이 가능한 상태. |
| | 4.2.1 | 실시간 데이터 수집기 구현 | ☐ 미시작 | 바이낸스 웹소켓에 연결하여 1시간봉 OHLCV 데이터가 DB에 실시간으로 적재됨을 확인. |
| | 4.2.1 | 과거 데이터 수집기 구현 | ☐ 미시작 | API를 통해 BTC/USDT 1시간봉 기준 최소 5년치 데이터가 DB에 성공적으로 저장됨. |
| | 4.2.1 | 대체 데이터 수집기 구현 | ☐ 미시작 | 펀딩비, MVRV Z-Score 데이터가 정기적으로 수집되어 DB에 저장됨을 확인. |
| | 4.2.2 | 피처 엔지니어링 스크립트 작성 | ☐ 미시작 | 스크립트 실행 시, 원본 데이터프레임에 PRD에 명시된 모든 피처 컬럼이 정상적으로 추가됨. |
| | 4.2.2 | 삼중 장벽 레이블링 함수 구현 | ☐ 미시작 | 미리 정의된 테스트 케이스 5개에 대해 함수가 정확한 레이블(+1, -1, 0)을 반환함. |
| | 4.2.2 | 예측 모델(v1) 훈련 및 저장 | ☐ 미시작 | 워크 포워드 검증 절차에 따라 모델 훈련이 완료되고, 최종 모델 파일(.pkl)이 생성됨. |
| | 4.2.3 | 리스크 관리 모듈 클래스 작성 | ☐ 미시작 | RiskManager 클래스에 대한 단위 테스트(Unit Test) 5개 이상이 모두 통과함. |
| | 4.2.4 | 백테스팅 엔진 템플릿 구축 | ☐ 미시작 | Backtrader에서 단순 이동평균 교차 전략이 수수료/슬리피지 포함하여 정상 실행됨. |
| | 4.2.4 | v1 모델 백테스트 실행 및 평가 | ☐ 미시작 | 백테스트 결과, 성공 지표(샤프지수 > 1.0, MDD < 20%)를 만족하는 보고서가 생성됨. |
| | 4.2.5 | 알림 시스템(Telegram) 연동 | ☐ 미시작 | 테스트 메시지("High probability SHORT signal detected on BTCUSDT")가 텔레그램으로 정상 수신됨. |
| Phase 2 | 4.3.1 | 규칙 기반 실행 엔진 로직 구현 | ☐ 미시작 | Paper Trading 환경에서 10회 이상의 거래가 모델 신호 및 규칙에 따라 정확히 실행됨. |
| | 4.3.1 | 거래소 API 실행 핸들러 연동 | ☐ 미시작 | 바이낸스 테스트넷(Testnet)에서 소액 주문의 제출-모니터링-취소가 정상 작동함. |
| | 4.3.2 | 예측 모델(v2) 아키텍처 구현 | ☐ 미시작 | BiLSTM-Transformer 모델의 훈련 코드가 오류 없이 실행되고 손실(loss)이 감소함을 확인. |
| | 4.3.2 | v1 vs v2 모델 성능 비교 | ☐ 미시작 | 동일한 워크 포워드 검증 데이터셋에서 v2 모델이 v1 모델 대비 우수한 성능(F1-Score 기준)을 보임. |
| Phase 3 | 4.4.1 | DRL 시뮬레이션 환경 구축 | ☐ 미시작 | DRL 에이전트가 환경과 상호작용(State 수신, Action 전달, Reward 반환)하는 1개 에피소드가 완료됨. |
| | 4.4.1 | PPO 에이전트 구현 및 훈련 | ☐ 미시작 | 에이전트 훈련이 시작되고, 누적 보상 그래프가 장기적으로 우상향하는 경향을 보임. |
| | 4.4.1 | DRL 에이전트 통합 및 최종 테스트 | ☐ 미시작 | 훈련된 에이전트가 테스트넷 환경에서 리스크 관리 모듈의 통제 하에 자율적으로 거래를 수행함. |
